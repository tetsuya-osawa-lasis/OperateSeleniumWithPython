using OpenQA.Selenium;
using System;
using System.Collections.Generic;
using System.Linq;

/// <summary>
/// Selenium操作を提供する管理クラス
/// </summary>
public class SeleniumManager
{
    // プロパティは設計に記載されていないため、省略します。

    /// <summary>
    /// HTMLの「a」タグの中から、指定された文字列を含む最初のエレメントを取得します。
    /// </summary>
    /// <param name="webDriver">SeleniumのWebドライバ</param>
    /// <param name="searchText">検索する文字列</param>
    /// <returns>指定された文字列を含む最初のエレメント。見つからない場合はデフォルト値 (null) を返却。</returns>
    public IWebElement GetFirstAnchorElementWithText(IWebDriver webDriver, string searchText)
    {
        // 戻り値用の変数を定義し、デフォルト値として初期化します。
        var resultElement = (IWebElement)null;

        if (webDriver == null)
        {
            Console.WriteLine("Webドライバがnullです。");
            return resultElement;
        }

        if (string.IsNullOrEmpty(searchText))
        {
            // "" は String.Empty とします。
            searchText = String.Empty;
        }

        try
        {
            // HTMLに含まれる、すべての「a」タグを取得する。（LIST型）
            var anchorElements = webDriver.FindElements(By.TagName("a"));

            // 上記の「a」タグのリストに対して、ループ処理を行う。
            foreach (var anchorElement in anchorElements)
            {
                // ループ処理の中で、「a」タグの配下に、引数で渡された「指定された文字列」が含まれる「a」タグを特定する。
                // 具体的には、エレメントのテキストを取得し、指定された文字列が含まれているかを確認します。
                if (anchorElement.Text.Contains(searchText))
                {
                    resultElement = anchorElement;
                    // 最初に見つかった時点でループを抜けます。
                    break;
                }
            }
        }
        catch (WebDriverException ex)
        {
            Console.WriteLine($"Selenium操作中にエラーが発生しました: {ex.Message}");
            // エラー発生時もデフォルト値を返却します。
        }

        // 結果を返却します。
        return resultElement;
    }
}
